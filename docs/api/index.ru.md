---
hide:
  - navigation
#   - toc
---

# API

## Пример запроса

Пример curl `curl -H 'Authorization: Bearer ${secret}'  http://${controller-api}/configs?force=true -d '{"path": "", "payload": ""}' -X PUT`

Этот запрос содержит заголовок `'Authorization: Bearer ${secret}'`, где:

- `${secret}` - ключ [api](../config/general.md#api), заданный в конфигурационном файле
- `${controller-api}` - адрес прослушивания [api](../config/general.md#api), указанный в конфигурационном файле
- `?force=true` - параметр, который требуется для некоторых запросов
- `'{"path": "", "payload": ""}'` - данные обновляемого ресурса

!!! note 
    Если вам нужно передать путь, обратите внимание: если путь не находится в рабочем каталоге mihomo, вручную задайте переменную среды SAFE_PATHS, чтобы добавить его в безопасный путь. Синтаксис этой переменной среды совпадает с правилом анализа переменной среды PATH этой операционной системы (то есть он разделяется точкой с запятой в Windows и двоеточием в других системах).

## Логи

### `/logs`

!!! info ""
    Получение логов в реальном времени

- Метод запроса: `GET` / `WS`
- Необязательный параметр: `?level=log_level`, где `log_level` может быть `info`, `warning`, `error`, `debug`

## Информация о трафике

### `/traffic`

!!! info ""
    Получение информации о трафике в реальном времени, в kbps

- Метод запроса: `GET` / `WS`

## Информация о памяти

### `/memory`

!!! info ""
    Получение информации об использовании памяти в реальном времени, в kb

- Метод запроса: `GET` / `WS`

## Информация о версии

### `/version`

!!! info ""
    Получение версии Clash

- Метод запроса: `GET`

## Кэш

### `/cache/fakeip/flush`

!!! info ""
    Очистка кэша fakeip

- Метод запроса: `POST`

### `/cache/dns/flush`

!!! info ""
    Очистка кэша DNS

- Метод запроса: `POST`

## Рабочая конфигурация

### `/configs`

!!! info ""
    Получение базовой конфигурации

- Метод запроса: `GET`

!!! info ""
    Перезагрузка базовой конфигурации

- Метод запроса: `PUT`
- Параметр: `?force=true`

!!! info ""
    Обновление базовой конфигурации

- Метод запроса: `PATCH`
- Данные: `'{"mixed-port": 7890}'`

### `/configs/geo`

!!! info ""
    Обновление GEO базы данных

- Метод запроса: `POST`
- Данные: `'{"path": "", "payload": ""}'`

### `/restart`

!!! info ""
    Перезапуск ядра

- Метод запроса: `POST`
- Данные: `'{"path": "", "payload": ""}'`

## Обновления

### `/upgrade`

!!! info ""
    Обновление ядра

- Метод запроса: `POST`
- Данные: `'{"path": "", "payload": ""}'`

### `/upgrade/ui`

!!! info ""
    Обновление панели управления, требуется настройка [external-ui](../config/general.md#_7)

- Метод запроса: `POST`

### `/upgrade/geo`

!!! info ""
    Обновление GEO базы данных

- Метод запроса: `POST`
- Данные: `'{"path": "", "payload": ""}'`

## Группы политик

### `/group`

!!! info ""
    Получение информации о группах политик

- Метод запроса: `GET`

### `/group/group_name`

!!! info ""
    Получение информации о конкретной группе политик

- Метод запроса: `GET`

!!! info ""
    Очистка фиксированного выбора автоматической группы политик

- Метод запроса: `DELETE`

### `/group/group_name/delay`

!!! info ""
    Тестирование узлов/групп политик в указанной группе политик, возвращает новую информацию о задержке и очищает фиксированный выбор автоматической группы политик

- Метод запроса: `GET`
- Параметр: `?url=xxx&timeout=5000`

## Прокси

### `/proxies`

!!! info ""
    Получение информации о прокси

- Метод запроса: `GET`

### `/proxies/proxies_name`

!!! info ""
    Получение информации о конкретном прокси

- Метод запроса: `GET`

!!! info ""
    Выбор конкретного прокси

- Метод запроса: `PUT`
- Данные: `'{"name":"Япония"}'`

### `/proxies/proxies_name/delay`

!!! info ""
    Тестирование указанного прокси и возврат новой информации о задержке

- Метод запроса: `GET`
- Параметр: `?url=xxx&timeout=5000`

## Наборы прокси

### `/providers/proxies`

!!! info ""
    Получение всей информации о всех наборах прокси

- Метод запроса: `GET`

### `/providers/proxies/providers_name`

!!! info ""
    Получение информации о конкретном наборе прокси

- Метод запроса: `GET`

!!! info ""
    Обновление набора прокси

- Метод запроса: `PUT`

### `/providers/proxies/providers_name/healthcheck`

!!! info ""
    Запуск проверки работоспособности конкретного набора прокси

- Метод запроса: `GET`

### `/providers/proxies/providers_name/proxies_name/healthcheck`

!!! info ""
    Тестирование указанного прокси в наборе прокси и возврат новой информации о задержке

- Метод запроса: `GET`
- Параметр: `?url=xxx&timeout=5000`

## Правила

### `/rules`

!!! info ""
    Получение информации о правилах

- Метод запроса: `GET`

## Наборы правил

### `/providers/rules`

!!! info ""
    Получение всей информации о всех наборах правил

- Метод запроса: `GET`

### `/providers/rules/providers_name`

!!! info ""
    Обновление набора правил

- Метод запроса: `PUT`

## Соединения

### `/connections`

!!! info ""
    Получение информации о соединениях

- Метод запроса: `GET` / `WS`
- Необязательный параметр: `?interval=milliseconds`, где `milliseconds` - интервал обновления, стандартное значение 1000 миллисекунд

!!! info ""
    Закрытие всех соединений

- Метод запроса: `DELETE`

### `/connections/:id`

!!! info ""
    Закрытие конкретного соединения

- Метод запроса: `DELETE`

## DNS запросы

### `/dns/query`

!!! info ""
    Получение данных DNS запроса для указанного имени и типа

- Метод запроса: `GET`
- Параметр: `?name=example.com&type=A`

## DEBUG

`/debug` требует, чтобы [уровень логирования](../config/general.md#_5) был установлен на `debug` при запуске ядра

### `/debug/gc`

!!! info ""
    Запуск принудительной сборки мусора

- Метод запроса: `PUT`

### `/debug/pprof`

Открыв в браузере `http://${controller-api}/debug/pprof`, можно просмотреть исходную отладочную информацию, где:

- allocs показывает ситуацию с выделением памяти для каждого вызова функции, включая размер памяти, выделенной в стеке и куче, а также количество выделений памяти. Этот отчет в основном помогает находить проблемы с утечками памяти и частыми запросами на выделение памяти в коде.
- отчет heap предоставляет подробную информацию об использовании памяти в куче программой, включая размер, количество и адреса выделенных блоков памяти, отсортированных по размеру. Этот отчет в основном используется для поиска мест с высоким использованием памяти, можно просмотреть размеры объектов в отчете heap, чтобы найти места с высоким использованием памяти.

#### Установите [Graphviz](https://graphviz.org/download/), чтобы просматривать графическую отладочную информацию

##### Просмотр графического отчета Heap

```shell
go tool pprof -http=:8080 http://127.0.0.1:xxxx/debug/pprof/heap
```

[Полное изображение](../assets/image/api/heap.svg)

##### Просмотр графического отчета Allocs

```shell
go tool pprof -http=:8080 http://127.0.0.1:xxxx/debug/pprof/allocs
```

[Пример вывода](../assets/image/api/allocs.svg)

##### Отправка отчета

Откройте в браузере `http://${controller-api}/debug/pprof/heap?raw=true`, чтобы загрузить этот файл, и загрузите его в [issues](https://github.com/MetaCubeX/mihomo/issues), чтобы сообщить о проблеме, с которой вы столкнулись. 
